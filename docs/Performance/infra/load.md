# 성능 향상 분석 보고서

## 개요
본 문서는 k6 부하 테스트를 통해 **단일 인스턴스 환경(1개)**과  
**로드밸런싱 환경(인스턴스 3개)**을 비교하여 성능 향상 효과를 분석한 결과를 담고 있다.

## 테스트 환경
- **단일 인스턴스 (1개)**
- **로드밸런싱 인스턴스 (3개)**
- 테스트 스크립트: 회원가입 → 로그인 → 토큰 갱신 → 로그아웃 시나리오
- VUs: 200, Duration: 10초

## 결과 요약

| 항목 | 단일 인스턴스 (1개) | 로드밸런싱 인스턴스 (3개) |
|------|--------------------|--------------------------|
| 총 요청 수 (http_reqs) | 1600 (125.76/s) | 1600 (132.93/s) |
| 성공률 (checks_succeeded) | 100% (1600/1600) | 100% (1600/1600) |
| 평균 응답 시간 (http_req_duration) | 489.67ms | 406.03ms |
| 최대 응답 시간 (max) | 2.24s | 2.40s |
| 90% 응답 시간 (p90) | 1.22s | 1.21s |
| Iteration 평균 시간 | 5.96s | 5.62s |
| 데이터 수신량 | 892 kB (70 kB/s) | 892 kB (74 kB/s) |
| 데이터 송신량 | 690 kB (54 kB/s) | 690 kB (57 kB/s) |

## 성능 향상 포인트
- **응답 속도 개선**: 로드밸런싱 환경이 평균 응답 시간에서 약 17% 더 빠름 (489.67ms → 406.03ms)
- **처리율 증가**: 초당 요청 처리량이 더 높음 (125.76/s → 132.93/s)
- **Iteration 효율성**: 평균 Iteration 시간이 더 짧아 사용자 경험 개선 (5.96s → 5.62s)
- **안정성 유지**: 두 환경 모두 실패율 0%로 안정적

## 결론
로드밸런싱(인스턴스 3개) 환경은 **응답 속도, 처리율, Iteration 효율성**에서 단일 인스턴스보다 우수한 성능을 보여준다.  
특히 평균 응답 시간과 초당 요청 처리량에서 차이가 뚜렷하며, 안정성은 동일하게 유지된다.  
따라서 서비스 확장성과 성능 최적화를 위해 로드밸런싱 환경이 더 적합하다고 결론지을 수 있다.

---

## 기술적 선택과 이유 (Technical Decision)

### 왜 Scale-Out인가?
단일 서버의 사양을 높이는 Scale-Up은 비용 효율이 떨어지고 물리적 한계가 명확합니다. 트래픽 증가에 유연하게 대처하기 위해 **Docker Swarm을 이용한 수평적 확장(Scale-Out)** 전략을 선택했습니다.
- **고가용성(HA)**: 서버 하나가 죽어도 나머지 인스턴스가 요청을 처리하므로 서비스 중단이 없음.
- **부하 분산**: Round-Robin 방식으로 트래픽을 분산시켜 개별 인스턴스의 CPU/Memory 부하를 경감.

## 트레이드 오프와 고민의 흔적 (Trade-off & Constraints)

### 1. 상태 관리 (Stateful vs Stateless)
- **문제**: 세션 정보를 서버 메모리에 저장하면 로드밸런싱 시 로그인이 풀리는 문제가 발생합니다.
- **해결**: **JWT(Stateless) + Redis(Shared Storage)** 구조를 채택하여, 어떤 인스턴스가 요청을 받더라도 동일한 인증 상태를 유지할 수 있도록 설계했습니다.

### 2. 복잡성 증가
- **트레이드 오프**: 인스턴스가 늘어나면 로그 수집, 배포, 모니터링이 복잡해집니다.
- **대안**: 현재는 Docker Compose/Swarm으로 관리하지만, 향후 로그 중앙화(ELK Stack)나 모니터링 도구(Grafana/Prometheus)의 중요성이 커질 것임을 인지하고 있습니다.

## 회고와 배운 점 (Retrospective)

인스턴스를 3배(1개 → 3개)로 늘렸다고 해서 성능이 정직하게 3배가 되지 않는다는 점(Amdahl's Law)을 확인했습니다.
네트워크 오버헤드, DB 병목, 로드밸런서 자체의 지연 등으로 인해 성능 향상폭은 약 17% 수준이었습니다.
하지만 **"단일 장애 지점(SPOF) 제거"**라는 측면에서 로드밸런싱은 성능 그 이상의 가치가 있음을 배웠습니다.
앞으로는 인스턴스 개수 조절뿐만 아니라, **DB 커넥션 풀 최적화** 등 애플리케이션 레벨의 튜닝이 병행되어야 함을 느꼈습니다.