# 인프라 확장성(Scale-Out) 성능 분석 보고서

## 1. 개요
본 문서는 k6 부하 테스트를 통해 **단일 인스턴스 환경**과 **다중 인스턴스(Scale-Out) 로드밸런싱 환경**의 성능을 비교 분석한 결과를 기술함.
수평적 확장이 실제 서비스 처리량과 안정성에 미치는 영향을 정량적으로 확인하는 것을 목적으로 함.

## 2. 테스트 환경
-   **단일 인스턴스**: 서비스 컨테이너 1개로 운영.
-   **다중 인스턴스**: 서비스 컨테이너 3개와 Docker Swarm의 내장 로드밸런서로 구성.
-   **테스트 스크립트**: `auth-test.js` (회원가입 → 로그인 → 토큰 갱신 → 로그아웃 시나리오)
-   **부하 설정**: 가상 사용자(VUs) 200명, 10초간 지속.

---

## 3. 📊 최종 성능 비교 (단일 vs 다중 인스턴스)

| 측정 항목 | 단일 인스턴스 (1개) | 다중 인스턴스 (3개) | 성능 향상 |
| :--- | :--- | :--- | :--- |
| **평균 응답 속도 (Avg)** | 489.67ms | **406.03ms** | 🚀 **1.2배 빠름 (17% 개선)** |
| **초당 요청 처리량 (RPS)** | 125.76 req/s | **132.93 req/s** | 🔥 **5.7% 증가** |
| **Iteration 평균 시간** | 5.96s | **5.62s** | **5.7% 단축** |
| **최대 지연 (Max)** | 2.24s | 2.40s | *유사 수준* |
| **성공률** | 100% | 100% | **안정성 유지** |

---

## 4. 💡 심층 분석

### 4.1. 성능 향상 포인트
-   **응답 속도 개선**: 로드밸런싱을 통해 개별 인스턴스의 부하가 분산되면서, 전체 평균 응답 시간이 약 **17%** 개선됨.
-   **처리율 증가**: 동일 시간 동안 더 많은 요청을 처리하여(RPS 증가), 서비스 전체의 처리 용량(Capacity)이 늘어났음을 확인함.

### 4.2. 성능 향상이 3배가 아닌 이유 (Amdahl's Law)
인스턴스를 3배로 늘렸음에도 성능이 3배로 향상되지 않은 이유는 다음과 같음.
-   **공유 자원 병목**: 모든 인스턴스는 단일 데이터베이스(DB)와 Redis를 공유함. 트래픽이 늘어날수록 DB 커넥션 풀, 네트워크 대역폭 등이 새로운 병목 지점이 됨.
-   **오버헤드**: 로드밸런서 자체의 라우팅 시간 등 미미한 오버헤드가 존재함.

## 5. 기술적 결정 (Technical Decision)

### 5.1. 왜 Scale-Out을 선택했는가?
단일 서버의 사양을 높이는 **Scale-Up**은 비용 효율이 떨어지고 물리적 한계가 명확함. 트래픽 증가에 유연하게 대처하기 위해 **Docker Swarm을 이용한 수평적 확장(Scale-Out)** 전략을 선택함.
-   **고가용성(High Availability)**: 서버 하나에 장애가 발생해도 나머지 인스턴스가 요청을 처리하므로 서비스 중단을 방지할 수 있음.
-   **탄력성(Elasticity)**: 트래픽 양에 따라 인스턴스 수를 동적으로 조절하여 비용을 최적화할 수 있음.

### 5.2. 상태 관리 (Stateless Architecture)
-   **문제**: 세션 정보를 개별 서버 메모리에 저장하면(Stateful), 로드밸런싱 시 요청이 다른 서버로 전달되어 로그인이 풀리는 문제가 발생함.
-   **해결**: **JWT(Stateless 인증) + Redis(공유 세션 저장소)** 구조를 채택하여, 어떤 인스턴스가 요청을 받더라도 동일한 인증 상태를 유지할 수 있도록 Stateless 아키텍처를 구현함.

## 6. 트레이드-오프 (Trade-offs)

### 6.1. 복잡성 증가
-   **고민**: 인스턴스가 늘어나면 로그 추적, 배포, 모니터링이 복잡해짐.
-   **해결**: 현재는 Docker Swarm으로 기본적인 관리를 하지만, 향후 **로그 중앙화(ELK Stack), 분산 추적(Zipkin), 통합 모니터링(Prometheus/Grafana)** 시스템의 도입 필요성을 인지하고 있음.

## 7. 회고 (Retrospective)
-   Scale-Out의 주된 목적은 성능의 선형적 증가보다는 **'단일 장애 지점(SPOF) 제거'를 통한 서비스 안정성 확보**에 있음을 확인함.
-   인스턴스 확장만으로는 공유 자원의 병목을 해결할 수 없으며, 향후 **DB 커넥션 풀 최적화, Read Replica 도입** 등 애플리케이션 및 데이터베이스 레벨의 추가적인 튜닝이 병행되어야 함을 배움.