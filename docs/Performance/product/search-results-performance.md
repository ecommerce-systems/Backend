# μƒν’ νμ΄μ§• κ²€μƒ‰ (Search Results) μ„±λ¥ λ¶„μ„ λ³΄κ³ μ„

## κ°μ”
λ³Έ λ¬Έμ„λ” k6 λ¶€ν• ν…μ¤νΈλ¥Ό ν†µν•΄ μƒν’ κ²€μƒ‰ κ²°κ³Ό νμ΄μ§• APIμΈ `/search/results`μ V1κ³Ό V2 μ—”λ“ν¬μΈνΈ μ„±λ¥μ„ λΉ„κµ λ¶„μ„ν• κ²°κ³Όλ¥Ό λ‹΄κ³  μμµλ‹λ‹¤. ν…μ¤νΈ κ³Όμ •μ—μ„ V2 μ—”λ“ν¬μΈνΈμ λ²„κ·Έλ¥Ό μμ •ν•μ€μΌλ©°, μμ • ν›„ μµμΆ… μ„±λ¥ ν…μ¤νΈλ¥Ό μ™„λ£ν–μµλ‹λ‹¤.

- **V1 API**: `GET /api/v1/products/search/results` (RDB λ‹¤μ¤‘ μ΅°μΈ κΈ°λ°)
- **V2 API**: `GET /api/v2/products/search/results` (λΉ„μ •κ·ν™” ν…μ΄λΈ” κΈ°λ°)

## ν…μ¤νΈ μ‹λ‚λ¦¬μ¤
- **ν…μ¤νΈ μ¤ν¬λ¦½νΈ**: `k6/tests/search-results.js`
- **μ‹λ‚λ¦¬μ¤**: V1κ³Ό V2 κ° μ—”λ“ν¬μΈνΈμ— λ€ν•΄ κ°€μƒ μ‚¬μ©μ(VUs) 50λ…μ΄ 20μ΄ λ™μ• λ¬΄μ‘μ„ ν‚¤μ›λ“λ΅ κ²€μƒ‰μ„ μ”μ²­ν•©λ‹λ‹¤.
- **V1 (μ •κ·ν™” λ¨λΈ)**: `Product` ν…μ΄λΈ”κ³Ό μ—¬λ¬ μΉ΄ν…κ³ λ¦¬ ν…μ΄λΈ”μ„ μ΅°μΈν•μ—¬ νμ΄μ§• κ²°κ³Όλ¥Ό λ°ν™ν•©λ‹λ‹¤.
- **V2 (λΉ„μ •κ·ν™” λ¨λΈ)**: `ProductSearch` λ‹¨μΌ ν…μ΄λΈ”μ—μ„ νμ΄μ§• κ²°κ³Όλ¥Ό λ°ν™ν•©λ‹λ‹¤.

---

## π V2 μ—”λ“ν¬μΈνΈ λ²„κ·Έ λ°κ²¬ λ° μμ •

μ΄κΈ° ν…μ¤νΈ κ³Όμ •μ—μ„ V2 μ—”λ“ν¬μΈνΈκ°€ μ§€μ†μ μΌλ΅ HTTP 500 μ—λ¬λ¥Ό λ°ν™ν•λ” λ¬Έμ λ¥Ό λ°κ²¬ν–μµλ‹λ‹¤.

### μ›μΈ λ¶„μ„
1.  V2 μ»¨νΈλ΅¤λ¬μ `searchProductResults` λ©”μ†λ“λ” κΈ°λ³Έ μ •λ ¬ νλΌλ―Έν„°λ΅ `id`λ¥Ό μ‚¬μ©ν•κ³  μμ—μµλ‹λ‹¤.
2.  ν•μ§€λ§ V2κ°€ μ‚¬μ©ν•λ” λΉ„μ •κ·ν™” ν…μ΄λΈ” `product_searches`μ™€ λ§¤ν•‘λ `ProductSearch` μ—”ν‹°ν‹°μ ID ν•„λ“λ” `id`κ°€ μ•„λ‹ `productId`λ΅ μ •μλμ–΄ μμ—μµλ‹λ‹¤.
3.  μ΄λ΅ μΈν•΄ Spring Data JPAκ°€ μ΅΄μ¬ν•μ§€ μ•λ” `id` ν•„λ“λ΅ μ •λ ¬μ„ μ‹λ„ν•λ©΄μ„ `QueryCreationException`μ΄ λ°μƒν–κ³ , μ„λ²„λ” 500 μ—λ¬λ¥Ό λ°ν™ν–μµλ‹λ‹¤.

### μ΅°μΉ
`ProductControllerV2.java`μ κΈ°λ³Έ μ •λ ¬ νλΌλ―Έν„°λ¥Ό `id`μ—μ„ `productId`λ΅ μμ •ν•μ—¬ λ²„κ·Έλ¥Ό ν•΄κ²°ν–μµλ‹λ‹¤. μ΄ μμ • μ΄ν›„ v2 μ—”λ“ν¬μΈνΈκ°€ μ •μƒμ μΌλ΅ λ™μ‘ν•λ” κ²ƒμ„ ν™•μΈν–μµλ‹λ‹¤.

---

## π“ μµμΆ… μ„±λ¥ λΉ„κµ κ²°κ³Ό (V1 vs V2)

λ²„κ·Έ μμ • ν›„, λ™μΌν• μ΅°κ±΄μ—μ„ V1κ³Ό V2 μ—”λ“ν¬μΈνΈμ μ„±λ¥μ„ λ‹¤μ‹ μΈ΅μ •ν–μΌλ©°, κ²°κ³Όλ” λ‹¤μκ³Ό κ°™μµλ‹λ‹¤.

| μΈ΅μ • ν•­λ© | V1 (λ‹¤μ¤‘ μ΅°μΈ) | V2 (λΉ„μ •κ·ν™”) | μ„±λ¥ ν–¥μƒ (V2 vs V1) |
| :--- | :--- | :--- | :--- |
| **ν‰κ·  μ‘λ‹µ μ†λ„ (Avg)** | 212.01ms | **21.50ms** | π€ **9.8λ°° λΉ λ¦„** |
| **μ¤‘μ•™κ°’ (Median)** | 137.00ms | **13.00ms** | π”¥ **10.5λ°° λΉ λ¦„** |
| **μƒμ„ 95% μ§€μ—° (p95)** | 941.20ms | **64.55ms** | β΅ **14.6λ°° λ” μ•μ •μ ** |
| **μµλ€ μ§€μ—° (Max)** | 1340.00ms | **255.00ms** | **μ§€μ—° μ‹κ°„ λ€ν­ κ°μ†** |
| **ν…μ¤νΈ μ„±κ³µλ¥ ** | 100% | 100% | - |

### π’΅ μ‹¬μΈµ λ¶„μ„
1.  **μ••λ„μ μΈ V2 μ„±λ¥**: V2λ” V1μ— λΉ„ν•΄ ν‰κ·  μ‘λ‹µ μ†λ„κ°€ **μ•½ 10λ°°** λΉ λ¥΄λ©°, μ‚¬μ©μκ°€ κ°€μ¥ λ§μ΄ μ²΄κ°ν•λ” μ¤‘μ•™κ°’(Median) μ—­μ‹ **10λ°° μ΄μƒ** λΉ λ¦…λ‹λ‹¤. μ΄λ” λΉ„μ •κ·ν™”λ λ‹¨μΌ ν…μ΄λΈ” μ΅°νμ μ„λ ¥μ„ λ…ν™•ν λ³΄μ—¬μ¤λ‹λ‹¤.
2.  **μ•μ •μ„± μ°¨μ΄ (p95)**: V1μ€ λ¶€ν•κ°€ λ°λ¦΄ κ²½μ° μΌλ¶€ μ”μ²­(μƒμ„ 5%)μ μ²λ¦¬ μ‹κ°„μ΄ 941msκΉμ§€ μΉμ†λ” λ°λ©΄, V2λ” λ™μΌν• μƒν™©μ—μ„λ„ 65ms λ‚΄μ™Έλ΅ λ§¤μ° μ•μ •μ μΈ μ„±λ¥μ„ μ μ§€ν•©λ‹λ‹¤. μ΄λ” V2κ°€ νΈλν”½ κΈ‰μ¦ μƒν™©μ—μ„ ν›¨μ”¬ λ” λ‚μ€ μ‚¬μ©μ κ²½ν—μ„ μ κ³µν•  μ μμμ„ μλ―Έν•©λ‹λ‹¤.
3.  **μ΅°μΈ(Join)μ λΉ„μ©**: V1μ νμ΄μ§• μΏΌλ¦¬λ” λ§¤λ² `Product` ν…μ΄λΈ”κ³Ό λ‹¤λ¥Έ μΉ΄ν…κ³ λ¦¬ ν…μ΄λΈ” κ°„μ λ³µμ΅ν• μ΅°μΈμ„ μν–‰ν•΄μ•Ό ν•λ―€λ΅ μ‘λ‹µ μ‹κ°„μ΄ κΈΈκ³  νΈμ°¨κ°€ ν½λ‹λ‹¤. V2λ” λ¨λ“  μ •λ³΄κ°€ λ‹΄κΈ΄ λ‹¨μΌ ν…μ΄λΈ”μ„ μ΅°νν•λ―€λ΅ μ΄λ¬ν• μ¤λ²„ν—¤λ“κ°€ μ—†μµλ‹λ‹¤.

## κ²°λ΅ 
**"νμ΄μ§• μΏΌλ¦¬μ—μ„λ„ λΉ„μ •κ·ν™”(Denormalization)λ” μ••λ„μ μΈ μ„±λ¥ μ°μ„λ¥Ό μ κ³µν•λ‹¤."**

μ΄λ² ν…μ¤νΈλ¥Ό ν†µν•΄, λ‹¨μ λ©λ΅ μ΅°νλΏλ§ μ•„λ‹λΌ νμ΄μ§•μ΄ ν¬ν•¨λ λ³µν•© μ΅°νμ—μ„λ„ V2 μ•„ν‚¤ν…μ²κ°€ V1μ— λΉ„ν•΄ μ›”λ“±ν• μ„±λ¥κ³Ό μ•μ •μ„±μ„ μ κ³µν•¨μ„ ν™•μΈν–μµλ‹λ‹¤. νΉν, μμΈ΅ λ¶κ°€λ¥ν• λ¶€ν• μƒν™©μ—μ„λ„ μΌκ΄€λ μ„±λ¥μ„ μ μ§€ν•λ” V2μ λ¥λ ¥μ€ λ€κ·λ¨ νΈλν”½μ„ μ²λ¦¬ν•΄μ•Ό ν•λ” μ΄μ»¤λ¨Έμ¤ μ‹μ¤ν…μ— ν•„μμ μ…λ‹λ‹¤.

`search/results` μ—”λ“ν¬μΈνΈμ— λ€ν• V2 μ•„ν‚¤ν…μ² λ„μ…μ€ μ„±κ³µμ μ΄λΌκ³  νλ‹¨ν•  μ μμµλ‹λ‹¤.