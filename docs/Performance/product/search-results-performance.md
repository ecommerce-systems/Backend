# μƒν’ νμ΄μ§• κ²€μƒ‰ μ„±λ¥ λ¶„μ„ λ³΄κ³ μ„ (V1 vs V2)

## 1. κ°μ”
λ³Έ λ¬Έμ„λ” k6 λ¶€ν• ν…μ¤νΈλ¥Ό ν†µν•΄ μƒν’ κ²€μƒ‰ κ²°κ³Ό νμ΄μ§• API(`/search/results`)μ V1κ³Ό V2 μ—”λ“ν¬μΈνΈ μ„±λ¥μ„ λΉ„κµ λ¶„μ„ν• κ²°κ³Όλ¥Ό κΈ°μ ν•¨.
ν…μ¤νΈλ” **ν΄λΌμ΄μ–ΈνΈ-μ„λ²„ κ°„ ν†µμ‹  λ°©μ‹**μ μ°¨μ΄κ°€ μ„±λ¥μ— λ―ΈμΉλ” μν–¥μ„ κ·λ…ν•λ” λ° μ΄μ μ„ λ§μ¶¤.

-   **V1 (N+1 μ”μ²­ μ‹λ®¬λ μ΄μ…)**: κ²€μƒ‰ κ²°κ³Ό ID λ©λ΅μ„ λ¨Όμ € λ°›κ³ , κ° IDλ³„λ΅ μƒμ„Έ μ •λ³΄λ¥Ό λ‹¤μ‹ μ”μ²­ν•λ” λ°©μ‹. (μ΄ `1+N`ν HTTP μ”μ²­)
-   **V2 (λ‹¨μΌ μ”μ²­ μµμ ν™”)**: κ²€μƒ‰ κ²°κ³Όμ λ¨λ“  μƒμ„Έ μ •λ³΄λ¥Ό ν• λ²μ μ”μ²­μΌλ΅ λ°›λ” λ°©μ‹. (μ΄ `1`ν HTTP μ”μ²­)

## 2. ν…μ¤νΈ μ‹λ‚λ¦¬μ¤
-   **ν…μ¤νΈ μ¤ν¬λ¦½νΈ**: `k6/tests/search-results.js`
-   **μ‹λ‚λ¦¬μ¤**: κ°€μƒ μ‚¬μ©μ(VUs) 50λ…μ΄ 20μ΄ λ™μ• λ¬΄μ‘μ„ ν‚¤μ›λ“λ΅ νμ΄μ§• κ²€μƒ‰μ„ μ”μ²­ν•¨.

---

## 3. π V2 μ—”λ“ν¬μΈνΈ λ²„κ·Έ λ°κ²¬ λ° μμ •

μ΄κΈ° ν…μ¤νΈ κ³Όμ •μ—μ„ V2 μ—”λ“ν¬μΈνΈκ°€ HTTP 500 μ—λ¬λ¥Ό λ°ν™ν•λ” λ¬Έμ λ¥Ό λ°κ²¬ν•¨.

-   **μ›μΈ**: `ProductControllerV2`μ κΈ°λ³Έ μ •λ ¬ νλΌλ―Έν„°κ°€ `id`λ΅ μ„¤μ •λμ–΄ μμ—μΌλ‚, V2κ°€ μ‚¬μ©ν•λ” `ProductSearch` μ—”ν‹°ν‹°μ ID ν•„λ“λ” `productId`μ€μ. μ΄ λ¶μΌμΉλ΅ μΈν•΄ Spring Data JPAκ°€ `QueryCreationException`μ„ λ°μƒμ‹ν‚΄.
-   **μ΅°μΉ**: μ»¨νΈλ΅¤λ¬μ κΈ°λ³Έ μ •λ ¬ νλΌλ―Έν„°λ¥Ό `id`μ—μ„ `productId`λ΅ μμ •ν•μ—¬ λ²„κ·Έλ¥Ό ν•΄κ²°ν•¨.

---

## 4. π“ μµμΆ… μ„±λ¥ λΉ„κµ (V1 vs V2)

| μΈ΅μ • ν•­λ© | V1 (N+1 μ”μ²­) | V2 (λ‹¨μΌ μ”μ²­) | μ„±λ¥ ν–¥μƒ (V2 vs V1) |
| :--- | :--- | :--- | :--- |
| **ν‰κ·  μ‘λ‹µ μ†λ„ (Avg)** | 229.35ms | **18.60ms** | π€ **12.3λ°° λΉ λ¦„** |
| **μ¤‘μ•™κ°’ (Median)** | 181.00ms | **11.00ms** | π”¥ **16.5λ°° λΉ λ¦„** |
| **μƒμ„ 95% μ§€μ—° (p95)** | 591.40ms | **60.10ms** | β΅ **9.8λ°° λ” μ•μ •μ ** |
| **μµλ€ μ§€μ—° (Max)** | 1.07s | **343.00ms** | **μ§€μ—° μ¤νμ΄ν¬ 68% κ°μ†** |

---

## 5. π’΅ μ‹¬μΈµ λ¶„μ„

### 5.1. N+1 λ¬Έμ μ μ‹¬κ°μ„±
V1 λ°©μ‹μ€ μ΄κΈ° κ²€μƒ‰ 1ν + κ²°κ³Ό Nκ°μ— λ€ν• μƒμ„Έ μ΅°ν Nν, μ¦‰ `N+1`μ λ„¤νΈμ›ν¬ μ™•λ³µμ΄ λ°μƒν•¨. μ΄λ” V2κ°€ λ‹¨ 1λ²μ μ”μ²­μΌλ΅ λ¨λ“  μ •λ³΄λ¥Ό κ°€μ Έμ¤λ” κ²ƒμ— λΉ„ν•΄ **λ„¤νΈμ›ν¬ μ§€μ—° λ° μ„λ²„ λ¶€ν•λ¥Ό κΈ°ν•κΈ‰μμ μΌλ΅ μ¦κ°€**μ‹ν‚΄.

### 5.2. μ••λ„μ μΈ V2 μ„±λ¥
-   V2λ” V1μ— λΉ„ν•΄ ν‰κ·  μ‘λ‹µ μ†λ„κ°€ **μ•½ 12.3λ°°**, μ‚¬μ©μκ°€ κ°€μ¥ λ§μ΄ μ²΄κ°ν•λ” μ¤‘μ•™κ°’(Median)μ€ **16.5λ°°** λΉ λ¦„.
-   μ΄λ” λ¶ν•„μ”ν• λ‹¤μ¤‘ μ”μ²­μ„ μ κ±°ν•κ³  λ‹¨μΌ μ”μ²­μΌλ΅ ν•„μ”ν• λ¨λ“  λ°μ΄ν„°λ¥Ό μ κ³µν•λ” API λ””μμΈμ κ°•λ ¥ν•¨μ„ λ³΄μ—¬μ¤.

### 5.3. μ•μ •μ„± μ°¨μ΄ (p95)
V1μ€ λ¶€ν•κ°€ λ°λ¦΄ κ²½μ° μΌλ¶€ μ”μ²­(μƒμ„ 5%)μ μ²λ¦¬ μ‹κ°„μ΄ 591msκΉμ§€ μΉμ†λ” λ°λ©΄, V2λ” λ™μΌ μƒν™©μ—μ„λ„ 60ms λ‚΄μ™Έλ΅ λ§¤μ° μ•μ •μ μΈ μ„±λ¥μ„ μ μ§€ν•¨. μ΄λ” V2κ°€ νΈλν”½ κΈ‰μ¦ μ‹ ν›¨μ”¬ λ” λ‚μ€ μ‚¬μ©μ κ²½ν—μ„ μ κ³µν•  μ μμμ„ μλ―Έν•¨.

## 6. κ²°λ΅ 
**"ν΄λΌμ΄μ–ΈνΈ-μ„λ²„ κ°„ λ¶ν•„μ”ν• λ‹¤μ¤‘ μ”μ²­(N+1 λ¬Έμ )μ„ μ κ±°ν•κ³  ν• λ²μ μ”μ²­μΌλ΅ λ¨λ“  λ°μ΄ν„°λ¥Ό μ κ³µν•λ” V2 λ°©μ‹μ΄ μ••λ„μ μΈ μ„±λ¥ μ°μ„λ¥Ό μ κ³µν•λ‹¤."**

λ³Έ ν…μ¤νΈλ” λ°±μ—”λ“μ DB μ΅°ν λ°©μ‹(JOIN vs λΉ„μ •κ·ν™”) μµμ ν™”λ¥Ό λ„μ–΄, **ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ κ°„μ ν¨κ³Όμ μΈ ν†µμ‹  λ°©μ‹(API Design)**μ΄ μ „μ²΄ μ‹μ¤ν… μ„±λ¥μ— μ–Όλ§λ‚ μ§€λ€ν• μν–¥μ„ λ―ΈμΉλ”μ§€ λ…ν™•ν•κ² λ³΄μ—¬μ¤. `search/results` μ—”λ“ν¬μΈνΈμ— λ€ν• V2 μ•„ν‚¤ν…μ² λ„μ…μ€ μ„±κ³µμ μ΄λΌκ³  νλ‹¨ν•  μ μμ.
