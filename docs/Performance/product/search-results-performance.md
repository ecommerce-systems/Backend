# μƒν’ νμ΄μ§• κ²€μƒ‰ (Search Results) μ„±λ¥ λ¶„μ„ λ³΄κ³ μ„

## κ°μ”
λ³Έ λ¬Έμ„λ” k6 λ¶€ν• ν…μ¤νΈλ¥Ό ν†µν•΄ μƒν’ κ²€μƒ‰ κ²°κ³Ό νμ΄μ§• APIμΈ `/search/results`μ V1κ³Ό V2 μ—”λ“ν¬μΈνΈ μ„±λ¥μ„ λΉ„κµ λ¶„μ„ν• κ²°κ³Όλ¥Ό λ‹΄κ³  μμµλ‹λ‹¤. ν…μ¤νΈ κ³Όμ •μ—μ„ V2 μ—”λ“ν¬μΈνΈμ λ²„κ·Έλ¥Ό μμ •ν•μ€μΌλ©°, μµμΆ… ν…μ¤νΈ μ •μμ— λ”°λΌ μ„±λ¥ ν…μ¤νΈλ¥Ό μ™„λ£ν–μµλ‹λ‹¤.

-   **V1 API (`/api/v1/products/search/results`)**: κ²€μƒ‰ κ²°κ³Ό λ¦¬μ¤νΈμ IDλ“¤μ„ λ¨Όμ € λ°›μ€ ν›„, κ° IDλ³„λ΅ μƒμ„Έ μ •λ³΄λ¥Ό **λ‹¤μ‹ μ”μ²­**ν•μ—¬ κ°€μ Έμ¤λ” λ°©μ‹ (N+1 λ¬Έμ  μ‹λ®¬λ μ΄μ…)
-   **V2 API (`/api/v2/products/search/results`)**: κ²€μƒ‰ κ²°κ³Ό λ¦¬μ¤νΈμ μƒμ„Έ μ •λ³΄λ¥Ό **ν• λ²μ μ”μ²­**μΌλ΅ λ¨λ‘ κ°€μ Έμ¤λ” λ°©μ‹

## ν…μ¤νΈ μ‹λ‚λ¦¬μ¤
-   **ν…μ¤νΈ μ¤ν¬λ¦½νΈ**: `k6/tests/search-results.js`
-   **μ‹λ‚λ¦¬μ¤**: V1κ³Ό V2 κ° μ—”λ“ν¬μΈνΈμ— λ€ν•΄ κ°€μƒ μ‚¬μ©μ(VUs) 50λ…μ΄ 20μ΄ λ™μ• λ¬΄μ‘μ„ ν‚¤μ›λ“λ΅ κ²€μƒ‰μ„ μ”μ²­ν•©λ‹λ‹¤.
    *   **V1 (N+1 λ¬Έμ  μ‹λ®¬λ μ΄μ…)**: μ΄κΈ° κ²€μƒ‰ μ”μ²­μΌλ΅ ID λ©λ΅μ„ λ°›μ€ ν›„, κ° IDμ— λ€ν•΄ λ³„λ„μ μƒμ„Έ μ΅°ν μ”μ²­μ„ λ³΄λƒ…λ‹λ‹¤. (μ΄ N+1ν HTTP μ”μ²­ λ°μƒ)
    *   **V2 (λ‹¨μΌ μ”μ²­ μµμ ν™”)**: λ‹¨ ν• λ²μ μ”μ²­μΌλ΅ λ¨λ“  κ²€μƒ‰ κ²°κ³Ό μƒμ„Έλ¥Ό λ°›μµλ‹λ‹¤. (μ΄ 1ν HTTP μ”μ²­ λ°μƒ)

---

## π V2 μ—”λ“ν¬μΈνΈ λ²„κ·Έ λ°κ²¬ λ° μμ •

μ΄κΈ° ν…μ¤νΈ κ³Όμ •μ—μ„ V2 μ—”λ“ν¬μΈνΈκ°€ μ§€μ†μ μΌλ΅ HTTP 500 μ—λ¬λ¥Ό λ°ν™ν•λ” λ¬Έμ λ¥Ό λ°κ²¬ν–μµλ‹λ‹¤.

### μ›μΈ λ¶„μ„
1.  V2 μ»¨νΈλ΅¤λ¬μ `searchProductResults` λ©”μ†λ“λ” κΈ°λ³Έ μ •λ ¬ νλΌλ―Έν„°λ΅ `id`λ¥Ό μ‚¬μ©ν•κ³  μμ—μµλ‹λ‹¤.
2.  ν•μ§€λ§ V2κ°€ μ‚¬μ©ν•λ” λΉ„μ •κ·ν™” ν…μ΄λΈ” `product_searches`μ™€ λ§¤ν•‘λ `ProductSearch` μ—”ν‹°ν‹°μ ID ν•„λ“λ” `id`κ°€ μ•„λ‹ `productId`λ΅ μ •μλμ–΄ μμ—μµλ‹λ‹¤.
3.  μ΄λ΅ μΈν•΄ Spring Data JPAκ°€ μ΅΄μ¬ν•μ§€ μ•λ” `id` ν•„λ“λ΅ μ •λ ¬μ„ μ‹λ„ν•λ©΄μ„ `QueryCreationException`μ΄ λ°μƒν–κ³ , μ„λ²„λ” 500 μ—λ¬λ¥Ό λ°ν™ν–μµλ‹λ‹¤.

### μ΅°μΉ
`ProductControllerV2.java`μ κΈ°λ³Έ μ •λ ¬ νλΌλ―Έν„°λ¥Ό `id`μ—μ„ `productId`λ΅ μμ •ν•μ—¬ λ²„κ·Έλ¥Ό ν•΄κ²°ν–μµλ‹λ‹¤. μ΄ μμ • μ΄ν›„ v2 μ—”λ“ν¬μΈνΈκ°€ μ •μƒμ μΌλ΅ λ™μ‘ν•λ” κ²ƒμ„ ν™•μΈν–μµλ‹λ‹¤.

---

## π“ μµμΆ… μ„±λ¥ λΉ„κµ κ²°κ³Ό (V1: N+1 μ”μ²­ vs V2: λ‹¨μΌ μ”μ²­)

λ²„κ·Έ μμ • ν›„, μƒλ΅μ΄ ν…μ¤νΈ μ •μμ— λ”°λΌ V1κ³Ό V2 μ—”λ“ν¬μΈνΈμ μ„±λ¥μ„ λ‹¤μ‹ μΈ΅μ •ν–μΌλ©°, κ²°κ³Όλ” λ‹¤μκ³Ό κ°™μµλ‹λ‹¤.

| μΈ΅μ • ν•­λ© | V1 (N+1 μ”μ²­) | V2 (λ‹¨μΌ μ”μ²­) | μ„±λ¥ ν–¥μƒ (V2 vs V1) |
| :--- | :--- | :--- | :--- |
| **ν‰κ·  μ‘λ‹µ μ†λ„ (Avg)** | 229.35ms | **18.60ms** | π€ **12.33λ°° λΉ λ¦„** |
| **μ¤‘μ•™κ°’ (Median)** | 181.00ms | **11.00ms** | π”¥ **16.45λ°° λΉ λ¦„** |
| **μƒμ„ 95% μ§€μ—° (p95)** | 591.40ms | **60.10ms** | β΅ **9.84λ°° λ” μ•μ •μ ** |
| **μµλ€ μ§€μ—° (Max)** | 1072.00ms | **343.00ms** | **μ§€μ—° μ‹κ°„ λ€ν­ κ°μ†** |
| **ν…μ¤νΈ μ„±κ³µλ¥ ** | 100% | 100% | - |

### π’΅ μ‹¬μΈµ λ¶„μ„
1.  **N+1 λ¬Έμ μ μ‹¬κ°μ„±**: V1μ€ μ΄κΈ° κ²€μƒ‰ κ²°κ³Ό 10κ°λ¥Ό κ°€μ Έμ¨ ν›„, κ° μƒν’μ μƒμ„Έ μ •λ³΄λ¥Ό λ‹¤μ‹ μ”μ²­ν•λ” `1 (κ²€μƒ‰) + N (μƒμ„Έ μ΅°ν)` ν•νƒμ μ”μ²­μ„ μν–‰ν•©λ‹λ‹¤. μ΄λ” V2κ°€ λ‹¨ 1λ²μ μ”μ²­μΌλ΅ λ¨λ“  μ •λ³΄λ¥Ό κ°€μ Έμ¤λ” κ²ƒμ— λΉ„ν•΄ **λ„¤νΈμ›ν¬ μ§€μ—° λ° μ„λ²„ λ¶€ν•λ¥Ό κΈ°ν•κΈ‰μμ μΌλ΅ μ¦κ°€**μ‹ν‚µλ‹λ‹¤.
2.  **μ••λ„μ μΈ V2 μ„±λ¥**: V2λ” V1μ— λΉ„ν•΄ ν‰κ·  μ‘λ‹µ μ†λ„κ°€ **μ•½ 12.3λ°°** λΉ λ¥΄λ©°, μ‚¬μ©μκ°€ κ°€μ¥ λ§μ΄ μ²΄κ°ν•λ” μ¤‘μ•™κ°’(Median) μ—­μ‹ **16λ°° μ΄μƒ** λΉ λ¦…λ‹λ‹¤. μ΄λ” λ¶ν•„μ”ν• λ‹¤μ¤‘ μ”μ²­μ„ μ κ±°ν•κ³  λ‹¨μΌ μ”μ²­μΌλ΅ ν•„μ”ν• λ¨λ“  λ°μ΄ν„°λ¥Ό μ κ³µν•λ” λ°©μ‹μ κ°•λ ¥ν•¨μ„ λ³΄μ—¬μ¤λ‹λ‹¤.
3.  **μ•μ •μ„± μ°¨μ΄ (p95)**: V1μ€ N+1 λ¬Έμ λ΅ μΈν•΄ λ¶€ν•κ°€ λ°λ¦΄ κ²½μ° μΌλ¶€ μ”μ²­(μƒμ„ 5%)μ μ²λ¦¬ μ‹κ°„μ΄ 591msκΉμ§€ μΉμ†λ” λ°λ©΄, V2λ” λ™μΌν• μƒν™©μ—μ„λ„ 60ms λ‚΄μ™Έλ΅ λ§¤μ° μ•μ •μ μΈ μ„±λ¥μ„ μ μ§€ν•©λ‹λ‹¤. μ΄λ” V2κ°€ νΈλν”½ κΈ‰μ¦ μƒν™©μ—μ„ ν›¨μ”¬ λ” λ‚μ€ μ‚¬μ©μ κ²½ν—μ„ μ κ³µν•  μ μμμ„ μλ―Έν•©λ‹λ‹¤.

## κ²°λ΅ 
**"ν΄λΌμ΄μ–ΈνΈ-μ„λ²„ κ°„ λ¶ν•„μ”ν• λ‹¤μ¤‘ μ”μ²­(N+1 λ¬Έμ )μ„ μ κ±°ν•κ³  ν• λ²μ μ”μ²­μΌλ΅ λ¨λ“  λ°μ΄ν„°λ¥Ό μ κ³µν•λ” V2 λ°©μ‹μ΄ μ••λ„μ μΈ μ„±λ¥ μ°μ„λ¥Ό μ κ³µν•λ‹¤."**

μ΄λ² ν…μ¤νΈλ” λ‹¨μν λ°±μ—”λ“ λ°μ΄ν„°λ² μ΄μ¤ μ΅°ν λ°©μ‹(JOIN vs λΉ„μ •κ·ν™”)μ μµμ ν™”λ¥Ό λ„μ–΄, **ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ κ°„μ ν¨κ³Όμ μΈ ν†µμ‹  λ°©μ‹** λν• μ „μ²΄ μ‹μ¤ν… μ„±λ¥μ— μ–Όλ§λ‚ μ§€λ€ν• μν–¥μ„ λ―ΈμΉλ”μ§€ λ…ν™•ν•κ² λ³΄μ—¬μ¤λ‹λ‹¤. V2 μ•„ν‚¤ν…μ²λ” λ°±μ—”λ“ μµμ ν™”μ™€ λ”λ¶μ–΄ ν΄λΌμ΄μ–ΈνΈ-μ„λ²„ μƒνΈμ‘μ©μ ν¨μ¨μ„±κΉμ§€ κ³ λ ¤ν•μ—¬ μ„¤κ³„λμ—μμ„ μ• μ μμµλ‹λ‹¤.

`search/results` μ—”λ“ν¬μΈνΈμ— λ€ν• V2 μ•„ν‚¤ν…μ² λ„μ…μ€ μ„±κ³µμ μ΄λΌκ³  νλ‹¨ν•  μ μμµλ‹λ‹¤.
