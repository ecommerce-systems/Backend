# 검색 성능 최적화 분석 보고서 (최종)

## 개요
본 문서는 k6 부하 테스트를 통해 **기존 정규화된 DB 구조 기반 검색(v1)**과 **역정규화된 검색 전용 테이블 기반 검색(v2)**을 비교 분석한 최종 결과를 담고 있다. 특히, DB 캐시 효과를 배제하기 위해 **랜덤 키워드 검색** 시나리오를 적용하여 가장 공정한 환경에서 테스트를 수행하였다.

## 테스트 환경
- **테스트 시나리오**: 10종의 다양한 키워드(Trousers, Shirt, Dress 등)를 무작위로 선택하여 검색 수행
- **기존 검색 (v1)**: `Product` 테이블과 10여 개의 카테고리 테이블을 **다중 조인(Join)**하여 검색
- **최적화 검색 (v2)**: 모든 검색 필드를 단일 테이블로 통합한 **역정규화 테이블**(`ProductSearch`) 조회
- **부하 설정**: 가상 사용자(VUs) 100명, 실행 시간 각 20초

---

## 📊 랜덤 키워드 검색 성능 비교 (실제 운영 환경 시뮬레이션)

DB 캐싱 편향을 제거한 후 측정한 핵심 성능 지표이다.

| 측정 항목 | 기존 검색 (v1) | 최적화 검색 (v2) | 성능 향상 (V2 vs V1) |
| :--- | :--- | :--- | :--- |
| **평균 응답 속도 (Avg)** | 101.05ms | **12.64ms** | 🚀 **8배 빠름** |
| **중앙값 (Median)** | 92.00ms | **7.00ms** | 🔥 **13.1배 빠름** |
| **상위 95% 지연 (p95)** | 212.90ms | **41.00ms** | ⚡ **5.2배 더 안정적** |
| **최대 지연 (Max)** | 385.00ms | **253.00ms** | **지연 시간 대폭 감소** |

### 💡 심층 분석
1. **조인(Join)의 물리적 한계 확인**: 
   - 고정 키워드 테스트 대비 V1의 평균 응답 시간이 **58ms에서 101ms로 약 2배 악화**됨. 이는 다양한 검색어 유입 시 DB가 매번 무거운 조인 연산을 수행해야 함을 의미함.
2. **역정규화의 견고함**: 
   - V2는 키워드 변화에 상관없이 **12ms대의 일정한 성능**을 유지함. 단일 테이블 인덱스 스캔의 효율성이 랜덤 쿼리 환경에서 더욱 빛을 발함.
3. **사용자 경험(UX) 격차**: 
   - 중앙값(Median) 기준 **13배의 속도 차이**는 실제 유저가 웹/앱에서 검색 결과를 기다릴 때 체감되는 속도 차이를 명확히 보여줌.

---

## 기술적 성과 요약

| 구분 | V1 (기존) | V2 (최적화) | 비고 |
|------|-----------|-------------|------|
| **검색 쿼리** | 다중 JOIN 발생 | **JOIN 제거 (Zero-Join)** | 구조적 단순화 |
| **인덱스 활용** | 복잡한 관계형 인덱스 | **단일 테이블 전용 인덱스** | 최적화 용이 |
| **부하 대응** | 동시 접속 시 급격한 지연 | **선형적인 응답 속도 유지** | 확장성 확보 |

## 결론
**"역정규화를 통한 조인 제거"**는 이커머스 검색 시스템에서 선택이 아닌 필수적인 최적화 전략이다. 
이번 공정 테스트를 통해 V2 아키텍처가 단순 조회 속도뿐만 아니라, **예측 불가능한 유저의 검색 패턴(랜덤 쿼리)에 대해서도 압도적인 안정성과 성능**을 제공함을 최종적으로 증명하였다.

## 향후 과제
- **데이터 동기화 최적화**: 쓰기(Write) 발생 시 원본 테이블과 검색 테이블 간의 정합성 유지 비용을 최소화하기 위한 비동기 처리(Event-driven) 고려.
- **Full-Text Search 도입**: 현재의 B-Tree 인덱스를 넘어선 대량 텍스트 검색 엔진(Elasticsearch 등)과의 성능 비교 로드맵 수립.
