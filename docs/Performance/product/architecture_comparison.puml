@startuml
skinparam componentStyle uml2

package "Legacy System (V1)" {
    [ProductControllerV1]
    [ProductService] as PS1
    [ProductRepository]
    
    database "Normalized DB Tables" {
        folder "11+ Related Tables" {
            [Product]
            [Category]
            [Department]
            [Brand]
            [Others...]
        }
    }
}

package "Optimized System (V2)" {
    [ProductControllerV2]
    [ProductService] as PS2
    [ProductSearchRepository]
    
    database "Denormalized DB Table" {
        [ProductSearch]
        note right of [ProductSearch]
            **Optimized for Read**
            - Single Table (No Joins)
            - Indexed Columns (prod_name, categories)
            - Prefix Search Optimized
        end note
    }
}

[ProductControllerV1] --> PS1
PS1 --> [ProductRepository] : JPA findAll / JOINs
[ProductRepository] <--> [Product] : Complex Queries (Slow)
[Product] ..> [Category] : @ManyToOne
[Product] ..> [Department] : @ManyToOne

[ProductControllerV2] --> PS2
PS2 --> [ProductSearchRepository] : Select * From ProductSearch
[ProductSearchRepository] <--> [ProductSearch] : Simple Query (Fast)

note bottom of [ProductControllerV1]
  **Bottlenecks:**
  1. Multiple JOINs (N+1 issues)
  2. Full Table Scan (LIKE %...%)
  3. No specific Index usage
end note

note bottom of [ProductControllerV2]
  **Improvements:**
  1. No JOINs (Flat Table)
  2. Index Range Scan (LIKE ...%)
  3. Hybrid Search (Prefix -> Contains)
  4. Dual Write Synchronization
end note

@enduml
